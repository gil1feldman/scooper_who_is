<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×–×”×” ××ª ×”× ×‘×—×¨ - ×—×™×“×•×Ÿ ×–×™×”×•×™ ×›×•×ª×‘×™×</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #1f0f3a;
            color: #ffffff;
        }

        .option-btn.selected {
            background-color: #a78bfa !important;
            border-color: #a78bfa !important;
            color: white !important;
            box-shadow: 0 0 15px rgba(167, 139, 250, 0.4);
        }

        .option-btn.correct {
            background-color: #10b981 !important;
            border-color: #10b981 !important;
            color: white !important;
        }

        .option-btn.wrong {
            background-color: #ef4444 !important;
            border-color: #ef4444 !important;
            opacity: 0.7;
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #a78bfa;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        a.revealed-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.2s;
        }

        /* Progress bar */
        .progress-bar-inner {
            transition: width 0.5s ease;
        }

        /* Difficulty selector */
        .diff-btn {
            transition: all 0.2s;
        }
        .diff-btn.active {
            transform: scale(1.05);
        }
        .diff-btn-easy.active {
            background-color: #10b981;
            border-color: #10b981;
            color: white;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
        }
        .diff-btn-medium.active {
            background-color: #f59e0b;
            border-color: #f59e0b;
            color: white;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.4);
        }
        .diff-btn-hard.active {
            background-color: #ef4444;
            border-color: #ef4444;
            color: white;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
        }

        /* Share button */
        #share-btn {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
        }
        #share-btn:hover {
            background: linear-gradient(135deg, #22d3ee, #a78bfa);
            transform: translateY(-2px);
        }

        /* Question counter badge */
        .q-counter {
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            padding: 2px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        /* Toast */
        #toast {
            transition: opacity 0.3s, transform 0.3s;
        }
        #toast.show {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-[#51367a] shadow-lg border-b border-purple-400/30 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-6 py-4 flex flex-col md:flex-row items-center justify-between gap-2">
            <div class="flex items-center gap-3">
                <div class="text-2xl font-black tracking-wider text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400 uppercase">
                    ×–×”×” ××ª ×”× ×‘×—×¨
                </div>
                <div class="h-6 w-px bg-purple-400/50 hidden md:block"></div>
                <h1 class="text-lg font-medium text-purple-100">×—×™×“×•×Ÿ ×–×™×”×•×™ ×›×•×ª×‘×™×</h1>
            </div>
            <!-- Progress indicator (shown after quiz starts) -->
            <div id="header-progress" class="hidden flex items-center gap-3">
                <span id="header-counter" class="q-counter">0 / 10</span>
                <div class="w-32 h-2 bg-purple-900 rounded-full overflow-hidden">
                    <div id="progress-bar" class="progress-bar-inner h-full bg-gradient-to-r from-cyan-400 to-purple-400 rounded-full" style="width:0%"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1 max-w-3xl w-full mx-auto p-6">
        
        <div id="intro-card" class="bg-gradient-to-br from-[#2d1b4e] to-[#1f0f3a] p-8 rounded-2xl border border-purple-400/20 shadow-xl mb-8 text-center">
            <p class="text-xl text-purple-100 leading-relaxed">
                ×œ×¤× ×™×›× 10 ×¤×•×¡×˜×™× ×©×¤×•×¨×¡××• ×¢×œ ×™×“×™ ×—×‘×¨×™ ×”×›× ×¡×ª ×‘×™××™× ×”××—×¨×•× ×™×. 
                <br>
                <span class="font-bold text-cyan-400">×”×× ×ª×¦×œ×™×—×• ×œ× ×—×© ××™ ×›×ª×‘ ××”?</span>
            </p>
            <p class="mt-4 text-sm text-purple-300">
                ×”× ×ª×•× ×™× ×‘×—×¡×•×ª ×—×‘×¨×ª <strong>×¡×§×•×¤×¨</strong> ×”××ª××—×” ×‘× ×™×˜×•×¨ ×©×™×— ×‘×¨×©×ª×•×ª ×•×‘××—×§×¨×™ ××“×™×”.
            </p>

            <!-- Difficulty selector -->
            <div class="mt-8">
                <p class="text-purple-200 text-sm mb-3 font-medium">×‘×—×¨×• ×¨××ª ×§×•×©×™:</p>
                <div class="flex justify-center gap-3 flex-wrap">
                    <button class="diff-btn diff-btn-easy border border-green-400/50 text-green-300 px-5 py-2 rounded-full font-bold" onclick="setDifficulty('easy', this)">
                        ğŸŸ¢ ×§×œ (3 ×›×•×ª×‘×™×)
                    </button>
                    <button class="diff-btn diff-btn-medium active border border-yellow-400/50 text-yellow-300 px-5 py-2 rounded-full font-bold bg-yellow-500/20" onclick="setDifficulty('medium', this)">
                        ğŸŸ¡ ×‘×™× ×•× ×™ (4 ×›×•×ª×‘×™×)
                    </button>
                    <button class="diff-btn diff-btn-hard border border-red-400/50 text-red-300 px-5 py-2 rounded-full font-bold" onclick="setDifficulty('hard', this)">
                        ğŸ”´ ×§×©×” (6 ×›×•×ª×‘×™×)
                    </button>
                </div>
            </div>
        </div>

        <div id="loading" class="text-center py-20">
            <div class="loader mb-4"></div>
            <p class="text-purple-200 text-lg">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
        </div>
        
        <div id="error-msg" class="hidden bg-red-900/50 border border-red-500/50 text-red-200 p-6 rounded-xl text-center mb-6">
            <p id="error-text"></p>
            <button onclick="initQuiz()" class="mt-4 bg-red-700 hover:bg-red-600 text-white px-6 py-2 rounded-full font-bold">× ×¡×” ×©×•×‘</button>
        </div>
        
        <div id="score-display" class="hidden bg-gradient-to-br from-[#51367a] to-[#4c1d95] p-8 rounded-2xl shadow-2xl border border-purple-400/30 text-center mb-8">
            <h2 class="text-purple-200 text-xl mb-2">×ª×•×¦××•×ª ×”× ×™×ª×•×—</h2>
            <div id="score-number" class="text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-400 mb-4">0/0</div>
            <button id="share-btn" onclick="shareResults()" class="text-white font-bold py-3 px-8 rounded-full shadow-lg transition text-lg border border-white/20 mt-2">
                ğŸ“¤ ×©×ª×£ ×ª×•×¦××•×ª
            </button>
        </div>

        <div id="quiz-list" class="space-y-8"></div>
        
        <div class="sticky bottom-6 text-center pointer-events-none mt-10">
            <button id="submit-btn" onclick="checkAnswers()" class="pointer-events-auto hidden bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white font-bold py-3 px-10 rounded-full shadow-lg transform transition hover:-translate-y-1 hover:shadow-cyan-500/50 text-lg border border-white/10">
                ×‘×“×™×§×ª ×ª×•×¦××•×ª
            </button>
        </div>
    </main>

    <footer class="text-center py-6 text-purple-400/50 text-sm border-t border-purple-400/10 mt-10">
        ×¤×™×ª×•×—: ×’×™×œ ×¤×œ×“××Ÿ | × ×ª×•× ×™×: ×¡×§×•×¤×¨ &copy; 2026
    </footer>

    <!-- Toast notification -->
    <div id="toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-green-700 text-white px-6 py-3 rounded-full shadow-xl font-bold text-sm opacity-0 translate-y-4 pointer-events-none z-50">
        ×”×•×¢×ª×§ ×œ×œ×•×—! ğŸ“‹
    </div>

    <script>
        const DATA_URL = "https://raw.githubusercontent.com/gil1feldman/data_files/main/scooper_who_write.csv";
        let activeQuestions = [];
        let userAnswers = {};
        let currentDifficulty = 'medium'; // easy=3, medium=4, hard=6
        let answeredCount = 0;
        let finalScore = 0;

        const DIFFICULTY_OPTIONS = { easy: 3, medium: 4, hard: 6 };

        // --- Gender detection ---
        // Returns 'female', 'male', or 'unknown'
        function detectGender(text) {
            if (!text) return 'unknown';

            // Strong female markers (verb endings, pronouns)
            const femalePatterns = [
                /\b×× ×™\s+\w*(×ª|×ª×™)\b/,   // ×× ×™ ×›×ª×‘×ª×™ / ×× ×™ ××¦×™×™× ×ª
                /\b\w+×ª×™\b/,              // verb 1st person female-like (shared but common)
                /\b×××¨×ª×™\b/,
                /\b(×”×™×|××ª|××•×ª×”|×©×œ×”|×œ×”)\b/i,
                /\b\w+(×ª|×•×ª)\s+(×›×™|×©|×œ|×‘|×|×¢×œ|×¢×|×”)\b/,  // ×¤×•×¢×œ × ×§×‘×” ×œ×¤× ×™ ××™×œ×ª ×™×—×¡
                // third person female verb
                /\b\w+×ª\s+(×›×™|×©|×œ|×‘|×|×¢×œ|×¢×|×”)\b/,
                // "×× ×™" + female verb ending
                /×× ×™\s+\w+×ª\b/,
                /×× ×™\s+\w+×•×ª\b/,
                // "×›×•×ª×‘×ª", "××“×‘×¨×ª", "×—×•×©×‘×ª" etc.
                /\b(×›×•×ª×‘×ª|××“×‘×¨×ª|×—×•×©×‘×ª|××•××¨×ª|×¨×•×¦×”|×™×•×¦××ª|× ××¦××ª|××•×›× ×”|×©××—×”|×’××”|×¢×¦×•×‘×”|××–××™× ×”|×§×•×¨××ª|××¦×™×¢×”|××‘×§×©×ª|××××™× ×”|×™×›×•×œ×”|×¦×¨×™×›×”|×¢×•×©×”)\b/,
            ];

            // Strong male markers
            const malePatterns = [
                /\b(×”×•×|××•×ª×•|×©×œ×•|×œ×•)\b/i,
                // "×× ×™" + male verb â€“ no ×ª ending
                /×× ×™\s+\w+[^×ª]\b/,
                /\b(×›×•×ª×‘|××“×‘×¨|×—×•×©×‘|××•××¨|×¨×•×¦×”|×™×•×¦×|× ××¦×|××•×›×Ÿ|×©××—|×’××”|×¢×¦×•×‘|××–××™×Ÿ|×§×•×¨×|××¦×™×¢|××‘×§×©|××××™×Ÿ|×™×›×•×œ|×¦×¨×™×š|×¢×•×©×”)\b/,
                /\b(×××¨|×”×œ×š|×‘×|×¨××”|×—×©×‘|×¢×©×”)\b/,
            ];

            let femaleScore = 0;
            let maleScore = 0;

            for (const pat of femalePatterns) {
                if (pat.test(text)) femaleScore++;
            }
            for (const pat of malePatterns) {
                if (pat.test(text)) maleScore++;
            }

            if (femaleScore > maleScore + 1) return 'female';
            if (maleScore > femaleScore + 1) return 'male';
            return 'unknown';
        }

        // --- Gender of author name (simple heuristic based on name suffix) ---
        function authorGender(name) {
            if (!name) return 'unknown';
            const firstName = name.trim().split(/\s+/)[0];
            // Common female name endings in Hebrew
            if (/[×”×]$/.test(firstName)) {
                // Ambiguous â€“ skip strong filtering
                return 'unknown';
            }
            // Try a small known-name list approach + pattern
            const femaleNames = ['××¨×‘', '×™× ×•×Ÿ', '×™×¢×œ', '×ª××¨', '× ×•×¢×”', '×©×¨×”', '×œ××”', '×¨×—×œ', '×“×™× ×”', '××™×›×œ', '××•×¨× ×”', '× ×™×¨×”', '×”×“×¨', '×©×œ×™', '×œ×™××ª', '×¨×•× ×™×ª', '×’×œ×™×ª', '×•×¨×“', '×“×¤× ×”', '××‘×™×’×™×œ', '×¨×—×œ', '× ×¢××™', '××•×¨×™×ª', '×¢×™× ×ª', '×”×™×œ×”', '×××™×”', '××™×™×œ×ª', '×¨×•×™×˜×œ', '×§×¨×Ÿ', '×¢× ×ª', '× ×˜×¢', '×œ×™××•×¨', '×›×¨××™×ª', '×©×™×¨×™', '×™×¨×“×Ÿ', '×¨×™×§×™', '×©×œ×•××™×ª', '×¨×™× ×ª', '××œ×™×ª', '× ×¢×”', '×™×”×•×“×™×ª', '×‘×ª×™×”', '××¤×¨×ª', '×™×¤×™×ª', '×¦×™×¤×™', '×¤× ×™× ×”', '×¨×¢×™×”', '×©×•×©× ×”', '×¤× ×™× ×”', '×¡×™×’×œ', '××–×œ', '×–×”×‘×”', '×’×‘×¨×™××œ×”', '××¨×’×œ×™×ª', '××¡×ª×¨', '×—× ×”', '×¨×‘×§×”', '×œ×™×œ×š', '× ×’×”', '×©×™×¨×”'];
            const maleNames = ['×‘× ×™××™×Ÿ', '×™×¦×—×§', '××‘×¨×”×', '××©×”', '×“×•×“', '×©×œ××”', '××¨×™×”', '×™×•×¡×£', '×¢××™×¨', '×’×“×™', '××‘×™', '×¨×•×Ÿ', '×’×œ', '×¢××™', '×××™×¨', '× ×ª×Ÿ', '×™×•××‘', '× ×™×¨', '××œ×™', '×™×—×™××œ', '×¢×™×“×Ÿ', '××œ×•×Ÿ', '×©××¢×•×Ÿ', '×™×•×‘×œ', '×‘×•×¢×–', '×’×“×¢×•×Ÿ', '××™×™×œ', '×“× ×™', '×’×™×', '×‘×¨×§', '× ×—×•×', '××™×ª×Ÿ', '×™×©×¨××œ', '××œ×—× ×Ÿ', '×—×™×™×', '××•×¨×™××œ', '×©×œ×•×', '××¨×™××œ', '×× ×—×', '×™××™×¨', '×–××‘', '×¨×', '×œ××•×Ÿ'];

            if (femaleNames.includes(firstName)) return 'female';
            if (maleNames.includes(firstName)) return 'male';

            // Ending heuristics
            if (/×™×ª$|×™×ª$|×”$/.test(firstName)) return 'female';
            if (/×•×Ÿ$|××œ$|××Ÿ$|×™×$/.test(firstName)) return 'male';

            return 'unknown';
        }

        function setDifficulty(level, btn) {
            currentDifficulty = level;
            document.querySelectorAll('.diff-btn').forEach(b => {
                b.classList.remove('active');
                // remove bg classes
                b.style.backgroundColor = '';
            });
            btn.classList.add('active');
        }

        function parseCSV(text) {
            let arr = [];
            let quote = false; 
            let row = 0, col = 0;
            let c = 0;
            arr[row] = ['']; 
            for (; c < text.length; c++) {
                let cc = text[c], nc = text[c+1];
                arr[row] = arr[row] || [];
                arr[row][col] = arr[row][col] || '';
                if (cc == '"' && quote && nc == '"') { arr[row][col] += '"'; c++; continue; }
                if (cc == '"') { quote = !quote; continue; }
                if (cc == ',' && !quote) { col++; arr[row][col] = ''; continue; }
                if (cc == '\r' && nc == '\n' && !quote) { row++; col = 0; c++; arr[row] = ['']; continue; }
                if (cc == '\n' && !quote) { row++; col = 0; arr[row] = ['']; continue; }
                arr[row][col] += cc;
            }
            return arr.filter(r => r.length > 1);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function isHebrew(text) {
            return /[\u0590-\u05FF]/.test(text);
        }

        function updateProgress() {
            const total = activeQuestions.length;
            const answered = Object.keys(userAnswers).length;
            document.getElementById('header-counter').textContent = `${answered} / ${total}`;
            document.getElementById('progress-bar').style.width = `${(answered / total) * 100}%`;
        }

        async function initQuiz() {
            answeredCount = 0;
            userAnswers = {};
            activeQuestions = [];
            document.getElementById('quiz-list').innerHTML = '';
            document.getElementById('score-display').classList.add('hidden');
            document.getElementById('error-msg').classList.add('hidden');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('header-progress').classList.add('hidden');
            document.getElementById('submit-btn').classList.add('hidden');

            const numOptions = DIFFICULTY_OPTIONS[currentDifficulty];

            try {
                const response = await fetch(DATA_URL);
                if (!response.ok) throw new Error('Network error');
                const csvText = await response.text();
                const data = parseCSV(csvText);
                const headers = data[0].map(h => h.trim().replace(/^\uFEFF/, ''));
                
                const colIndices = {
                    content: headers.findIndex(h => h.toLowerCase() === 'content'),
                    post_type: headers.findIndex(h => h.toLowerCase() === 'post_type'),
                    url: headers.findIndex(h => h.toLowerCase() === 'url'),
                    name: headers.findIndex(h => h.toLowerCase() === 'extra_source_attributes.name'),
                    tags: headers.findIndex(h => h.toLowerCase() === 'tags_internal')
                };

                const parsedPosts = data.slice(1).map(row => ({
                    content: row[colIndices.content],
                    post_type: row[colIndices.post_type],
                    url: row[colIndices.url],
                    name: row[colIndices.name],
                    tags: colIndices.tags !== -1 ? row[colIndices.tags] : ""
                })).filter(p => p.content && p.name);

                const filteredPosts = parsedPosts.filter(p => {
                    if (p.post_type !== "TEXT") return false;
                    const content = p.content.trim();
                    if (content.includes("RT @") || content.includes("QT @") || content.startsWith("@")) return false;
                    if (content.toLowerCase().includes("http")) return false;
                    if (p.tags.includes("isTwitterReply")) return false;
                    if (content.length < 25 || content.length > 300) return false;
                    if (!isHebrew(content)) return false; 
                    return true;
                });

                const allAuthors = [...new Set(filteredPosts.map(p => p.name))];

                // Build author-gender map
                const authorGenderMap = {};
                allAuthors.forEach(a => { authorGenderMap[a] = authorGender(a); });

                const short = shuffleArray(filteredPosts.filter(p => p.content.length <= 120));
                const long = shuffleArray(filteredPosts.filter(p => p.content.length > 120));
                const selected = shuffleArray([...short.slice(0, 5), ...long.slice(0, 5)]).slice(0, 10);
                
                activeQuestions = selected.map((post, index) => {
                    const postGender = detectGender(post.content);
                    const correctAuthorGender = authorGenderMap[post.name];

                    // Filter distractors by gender if text gender is identified
                    let candidateDistractors = allAuthors.filter(n => n !== post.name);
                    if (postGender === 'female') {
                        const femaleAuthors = candidateDistractors.filter(n => authorGenderMap[n] === 'female' || authorGenderMap[n] === 'unknown');
                        if (femaleAuthors.length >= numOptions - 1) {
                            candidateDistractors = femaleAuthors;
                        }
                        // else fall back to all
                    } else if (postGender === 'male') {
                        const maleAuthors = candidateDistractors.filter(n => authorGenderMap[n] === 'male' || authorGenderMap[n] === 'unknown');
                        if (maleAuthors.length >= numOptions - 1) {
                            candidateDistractors = maleAuthors;
                        }
                        // else fall back to all
                    }

                    const distractors = shuffleArray(candidateDistractors).slice(0, numOptions - 1);
                    // If not enough distractors, fill from all authors
                    if (distractors.length < numOptions - 1) {
                        const extra = shuffleArray(allAuthors.filter(n => n !== post.name && !distractors.includes(n))).slice(0, numOptions - 1 - distractors.length);
                        distractors.push(...extra);
                    }

                    return {
                        id: index,
                        content: post.content,
                        url: post.url,
                        correct: post.name,
                        options: shuffleArray([post.name, ...distractors]),
                        postGender
                    };
                });

                document.getElementById('loading').style.display = 'none';
                document.getElementById('submit-btn').classList.remove('hidden');
                document.getElementById('header-progress').classList.remove('hidden');
                document.getElementById('intro-card').classList.remove('hidden');
                updateProgress();
                renderQuiz();
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-text').innerText = "×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×. ×× × ×‘×“×§×• ××ª ×”×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜ ×•× ×¡×• ×©×•×‘.";
                document.getElementById('error-msg').classList.remove('hidden');
            }
        }

        function renderQuiz() {
            const container = document.getElementById('quiz-list');
            const numOptions = DIFFICULTY_OPTIONS[currentDifficulty];
            const gridCols = numOptions <= 4 ? 'md:grid-cols-2' : 'md:grid-cols-3';

            activeQuestions.forEach((q, idx) => {
                const card = document.createElement('div');
                card.className = 'bg-[#51367a] rounded-xl p-6 shadow-xl border border-purple-400/20 relative overflow-hidden transition';

                // Gender badge for debugging (optional - hidden in production)
                const genderBadge = q.postGender !== 'unknown' 
                    ? `<span class="text-xs text-purple-400 ml-2">${q.postGender === 'female' ? 'ğŸ‘©' : 'ğŸ‘¨'}</span>` 
                    : '';

                card.innerHTML = `
                    <div class="absolute top-0 right-0 bottom-0 w-1 bg-gradient-to-b from-cyan-400 to-blue-500"></div>
                    <div class="flex items-center gap-2 mb-3">
                        <span class="q-counter">×©××œ×” ${idx + 1} ××ª×•×š ${activeQuestions.length}</span>
                        ${genderBadge}
                    </div>
                    <div class="mb-6">
                        <div class="text-white text-lg leading-relaxed bg-[#1f0f3a]/50 p-5 rounded-lg border border-white/5" id="content-${q.id}">
                            ${q.content}
                        </div>
                    </div>
                    <div class="grid grid-cols-1 ${gridCols} gap-3" id="options-${q.id}">
                        ${q.options.map(opt => `<button class="option-btn text-right p-3 rounded-lg border border-purple-300/30 text-purple-100 hover:bg-purple-600/50" onclick="selectOption(${q.id}, '${opt.replace(/'/g, "\\'")}', this)">${opt}</button>`).join('')}
                    </div>
                    <div id="feedback-${q.id}" class="mt-4 p-3 rounded-lg text-sm font-bold hidden text-center"></div>
                `;
                container.appendChild(card);
            });
        }

        function selectOption(id, name, btn) {
            const wasAnswered = userAnswers.hasOwnProperty(id);
            userAnswers[id] = name;
            const parent = document.getElementById(`options-${id}`);
            parent.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            if (!wasAnswered) {
                updateProgress();
            }
        }

        function checkAnswers() {
            let score = 0;
            activeQuestions.forEach(q => {
                const isCorrect = userAnswers[q.id] === q.correct;
                if (isCorrect) score++;
                
                const feedbackEl = document.getElementById(`feedback-${q.id}`);
                const optionsDiv = document.getElementById(`options-${q.id}`);
                const contentDiv = document.getElementById(`content-${q.id}`);
                
                contentDiv.innerHTML = `<a href="${q.url}" target="_blank" class="revealed-link block">${q.content}<div class="mt-2 text-xs text-cyan-400">ğŸ”— ×¦×¤×” ×‘××§×•×¨</div></a>`;

                optionsDiv.querySelectorAll('.option-btn').forEach(btn => {
                    btn.disabled = true;
                    if (btn.innerText.trim() === q.correct) btn.classList.add('correct');
                    if (btn.innerText.trim() === userAnswers[q.id] && !isCorrect) btn.classList.add('wrong');
                });

                feedbackEl.className = `mt-4 p-3 rounded-lg text-sm font-bold text-center ${isCorrect ? 'bg-green-900/50 text-green-200' : 'bg-red-900/50 text-red-200'}`;
                feedbackEl.innerText = isCorrect ? 'âœ“ ×–×™×”×•×™ × ×›×•×Ÿ' : `âœ— ×”×›×•×ª×‘ ×”××§×•×¨×™: ${q.correct}`;
                feedbackEl.classList.remove('hidden');
            });

            finalScore = score;
            const total = activeQuestions.length;
            document.getElementById('score-number').innerText = `${score} / ${total}`;
            document.getElementById('score-display').classList.remove('hidden');
            document.getElementById('intro-card').classList.add('hidden');
            document.getElementById('submit-btn').parentElement.classList.add('hidden');

            // Update progress to full
            document.getElementById('header-counter').textContent = `${total} / ${total}`;
            document.getElementById('progress-bar').style.width = '100%';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function shareResults() {
            const total = activeQuestions.length;
            const diffLabel = { easy: '×§×œ', medium: '×‘×™× ×•× ×™', hard: '×§×©×”' }[currentDifficulty];
            const emoji = finalScore >= 8 ? 'ğŸ†' : finalScore >= 5 ? 'ğŸ¯' : 'ğŸ“š';
            const text = `${emoji} ×–×”×” ××ª ×”× ×‘×—×¨ â€“ ×—×™×“×•×Ÿ ×–×™×”×•×™ ×›×•×ª×‘×™×\n` +
                `×§×™×‘×œ×ª×™ ${finalScore}/${total} ×‘×¨××ª ×§×•×©×™ ${diffLabel}!\n` +
                `×”×× ×ª×¦×œ×™×—×• ×œ× ×—×© ××™ ×›×ª×‘ ××”?\n` +
                `https://scooper.co.il`;

            if (navigator.share) {
                navigator.share({ text }).catch(() => copyToClipboard(text));
            } else {
                copyToClipboard(text);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('×”×•×¢×ª×§ ×œ×œ×•×—! ğŸ“‹');
            }).catch(() => {
                // Fallback
                const ta = document.createElement('textarea');
                ta.value = text;
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                showToast('×”×•×¢×ª×§ ×œ×œ×•×—! ğŸ“‹');
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2500);
        }

        initQuiz();
    </script>
</body>
</html>
